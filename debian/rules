#!/usr/bin/make -f
# -*- makefile -*-

# Avoid overlinking and reduce library dependencies.
export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
	dh $@ --parallel --with autoreconf

.PHONY: override_dh_autoreconf
override_dh_autoreconf:
	dh_autoreconf sh -- autogen.sh

.PHONY: override_dh_auto_configure
override_dh_auto_configure:
	dh_auto_configure -- \
	    --enable-nullout \
	    --enable-alsa \
	    --disable-oss \
	    --enable-pulse \
	    --disable-coreaudio \
	    --enable-gtk2 \
	    --enable-gtk3 \
	    --enable-vfs-curl \
	    --enable-lfm \
	    --disable-artwork \
	    --disable-artwork-network \
	    --enable-supereq \
	    --disable-sid \
	    --enable-mad \
	    --disable-ffap \
	    --disable-vtx \
	    --disable-adplug \
	    --enable-hotkeys \
	    --enable-vorbis \
	    --disable-ffmpeg \
	    --disable-flac \
	    --disable-sndfile \
	    --disable-wavpack \
	    --disable-cdda \
	    --disable-gme \
	    --disable-notify \
	    --disable-shellexec \
	    --disable-musepack \
	    --disable-wildmidi \
	    --disable-tta \
	    --disable-dca \
	    --disable-aac \
	    --disable-mms \
	    --disable-staticlink \
	    --disable-src \
	    --disable-m3u \
	    --disable-vfs-zip \
	    --disable-converter \
	    --disable-artwork-imlib2 \
	    --disable-dumb \
	    --disable-shn \
	    --disable-psf \
	    --disable-mono2stereo \
	    --disable-shellexecui \
	    --disable-alac \
	    --disable-wma \
	    --disable-pltbrowser \
	    --libdir=/usr/lib/$(DEB_HOST_MULTIARCH)

.PHONY: override_dh_compress
override_dh_compress:
	dh_compress -XChangeLog

.PHONY: override_dh_install
override_dh_install:
	-$(RM) debian/tmp/usr/lib/*/deadbeef/*.la
	-$(RM) debian/tmp/usr/lib/*/deadbeef/*.a
	-$(RM) debian/deadbeef/usr/lib/*/deadbeef/*.so.0*
	dh_install -XCOPYING.GPLv2 -XCOPYING.LGPLv2.1 --fail-missing

.PHONY: override_dh_installdocs
override_dh_installdocs:
	dh_installdocs -XREADME
